# Data Pipeline для генерации и валидации SIT-данных

## Обзор

Этот проект реализует конвейер (pipeline) генерации и валидации синтетических данных, содержащих **Sensitive Information Types (SIT)** и **Test Categories (TC)**.  
Система создаёт разнообразные документы (тексты, DOCX, PDF, EML и др.), в которых присутствуют **реалистичные комбинации чувствительных данных**.  
Каждый документ помечается как **True Positive (TP)** или **False Positive (FP)** в зависимости от наличия реальных SIT-паттернов.  

Pipeline автоматизирует:
- создание метаданных и распределения SIT/TC;
- генерацию текстового контента с нужными метками;
- конвертацию в разные форматы;
- валидацию регулярными выражениями и формирование отчётов.

---

## Структура проекта

```
TEST_PIPELINE_DESIGN/
│
├── config.json               # Основной конфиг с параметрами и определениями SIT
│
├── modules/
│   ├── meta_generator.py     # Генерация метаданных и распределения SIT/TC
│   ├── content_generator.py  # Генерация текстов с SIT и случайным контекстом
│   ├── postprocessor.py      # Преобразование в разные форматы (.txt, .docx, .pdf, .eml)
│   └── validator.py          # Проверка файлов и формирование отчёта
│
├── output/
│   ├── files/                # Сгенерированные документы
│   ├── mapping_meta.csv      # Таблица распределения SIT по документам
│   ├── mapping_final.xlsx    # Итоговое сопоставление SIT и файлов
│   ├── meta.json             # Метаданные генерации
│   ├── postprocess.log       # Лог этапа постобработки
│   └── validation_report.txt # Отчёт валидации
│
├── templates/
│   ├── chat_templates.md
│   ├── doc_templates.md
│   └── email_templates.md
│
├── requirements.txt
├── show_sit_samples.py       # Скрипт для отображения примеров SIT-шаблонов
├── test.py                   
└── README.md
```

---

## Установка

Создайте виртуальное окружение и установите зависимости:

```bash
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
```

---

## Порядок выполнения

Модули запускаются строго поэтапно:

```bash
python modules/meta_generator.py
python modules/content_generator.py
python modules/postprocessor.py
python modules/validator.py
```

Каждый шаг использует результаты предыдущего, формируя полный цикл генерации и проверки данных.

---

## Описание модулей

### 1. meta_generator.py  
Формирует метаданные (`mapping_meta.csv`) с описанием:
- какие SIT/TC появятся в каждом документе;
- распределение TP/FP и количество инстансов;
- уровень достоверности (Low / Medium / High).

### 2. content_generator.py  
Создаёт синтетический текст на основе метаданных.  
Каждый документ содержит от 1 до нескольких SIT/TC в разных комбинациях, с контролем частоты и реалистичных контекстов.

### 3. postprocessor.py  
Конвертирует сгенерированные тексты в несколько форматов:
- `.txt`, `.docx`, `.pdf`, `.eml`, а также вложения (`.pptx`, `.xlsx`);
- формирует разнообразие типов контента (чаты, письма, документы).

### 4. validator.py  
Проверяет файлы по регулярным выражениям SIT из `config.json`.  
Формирует отчёт `validation_report.txt` с метриками:

- True Positives (TP)  
- False Positives (FP)  
- Пропущенные SIT-вхождения  

---

## Пример отчёта

```
SIT: SIT_SSN
  TP missing count: 10
  FP flagged count: 0
------------------------------------------------------------
SIT: SIT_DRIVER_US
  FP flagged count: 10
  sample matches: ['XXXXXXX']
```

---

## Конфигурация

В `config.json` можно управлять параметрами генерации:

| Параметр | Описание |
|-----------|-----------|
| `per_sit_count` | Количество документов на каждый SIT |
| `formats` | Список форматов для генерации |
| `sits` | Определения SIT и регулярные выражения |
| `output` | Пути для сохранения файлов и логов |

---

## Пример сценария

- 100 документов на каждый SIT/TC  
- Распределение количества SIT в документе:
  - 1 SIT — 30%
  - 2–3 SIT — 30%
  - 4–6 SIT — 30%
  - >6 SIT — 10%  
- Количество вхождений SIT в документ:
  - 1 — 35%
  - 3–5 — 35%
  - 6–10 — 20%
  - >10 — 10%

---

